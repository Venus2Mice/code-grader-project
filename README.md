# üìö Code Grader Project

> **H·ªá th·ªëng Ch·∫•m b√†i L·∫≠p tr√¨nh T·ª± ƒë·ªông**  
> Multi-language support: C++, C, Python, Java

---

## üéØ Gi·ªõi Thi·ªáu

**Code Grader** l√† m·ªôt n·ªÅn t·∫£ng web ƒë·ªÉ t·ª± ƒë·ªông h√≥a quy tr√¨nh ch·∫•m ƒëi·ªÉm c√°c b√†i t·∫≠p l·∫≠p tr√¨nh. H·ªá th·ªëng s·ª≠ d·ª•ng Docker sandbox ƒë·ªÉ ch·∫°y code an to√†n v√† RabbitMQ ƒë·ªÉ x·ª≠ l√Ω queue ch·∫•m b√†i.

### ‚ú® T√≠nh NƒÉng Ch√≠nh

- ‚úÖ **Auto Grading**: T·ª± ƒë·ªông ch·∫•m ƒëi·ªÉm v·ªõi test cases
- ‚úÖ **Multi-language**: C++, C, Python, Java
- ‚úÖ **Docker Sandbox**: Ch·∫°y code an to√†n, c√¥ l·∫≠p
- ‚úÖ **Class Management**: Teacher t·∫°o l·ªõp, student join b·∫±ng invite code
- ‚úÖ **Monaco Editor**: Code editor chuy√™n nghi·ªáp v·ªõi syntax highlighting
- ‚úÖ **Progress Tracking**: Theo d√µi ti·∫øn ƒë·ªô h·ªçc sinh

---

## üìÅ C·∫•u Tr√∫c D·ª± √Ån

```
code-grader-project/
‚îú‚îÄ‚îÄ backend/              # Flask API (Python)
‚îú‚îÄ‚îÄ frontend-new/         # Next.js 15 + TypeScript
‚îú‚îÄ‚îÄ frontend-old/         # React + Vite (backup)
‚îú‚îÄ‚îÄ grader-engine/        # Worker + Docker sandbox
‚îú‚îÄ‚îÄ docs/                 # üìö T√†i li·ªáu ƒë·∫ßy ƒë·ªß
‚îÇ   ‚îî‚îÄ‚îÄ DOCUMENTATION.md  # ‚≠ê T√†i li·ªáu t·ªïng h·ª£p duy nh·∫•t
‚îú‚îÄ‚îÄ scripts/              # üîß Scripts ti·ªán √≠ch
‚îÇ   ‚îú‚îÄ‚îÄ setup.sh
‚îÇ   ‚îî‚îÄ‚îÄ run_worker.sh
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---

## üöÄ QUICK START

### ‚ö° C√°ch 1: Setup T·ª± ƒê·ªông (Khuy√™n d√πng)

```bash
# Ch·∫°y script setup t·ª± ƒë·ªông
./setup.sh
```

**Script s·∫Ω t·ª± ƒë·ªông:**
- ‚úÖ Build v√† kh·ªüi ƒë·ªông t·∫•t c·∫£ services
- ‚úÖ Ch·∫°y migrations v√† seed database
- ‚úÖ T·∫°o d·ªØ li·ªáu test
- ‚úÖ Build Docker image cho grader
- ‚úÖ Ch·∫°y worker

**Sau khi setup th√†nh c√¥ng:**
- Frontend: http://localhost:3000
- Backend API: http://localhost:5000
- Swagger Docs: http://localhost:5000/api/docs
- RabbitMQ: http://localhost:15672

**T√†i kho·∫£n test:**
- Teacher: `teacher.dev@example.com` / `password`
- Student: `student.dev@example.com` / `password`

---

### üîÑ Ch·∫°y L·∫°i (Khi ƒë√£ setup)

```bash
# Start services
docker-compose up -d

# Ch·∫°y worker (terminal ri√™ng)
./run_worker.sh
```

---

## üìö T√ÄI LI·ªÜU HO√ÄN CH·ªàNH

**‚Üí XEM T·∫§T C·∫¢ H∆Ø·ªöNG D·∫™N CHI TI·∫æT T·∫†I: [`docs/DOCUMENTATION.md`](docs/DOCUMENTATION.md)**

T√†i li·ªáu bao g·ªìm:
- ‚úÖ Gi·ªõi thi·ªáu chi ti·∫øt
- ‚úÖ Quick Start & Setup
- ‚úÖ Ki·∫øn tr√∫c h·ªá th·ªëng
- ‚úÖ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng (Teacher & Student)
- ‚úÖ API Documentation (t·∫•t c·∫£ endpoints)
- ‚úÖ Testing Guide (E2E scenarios)
- ‚úÖ Troubleshooting (fix l·ªói th∆∞·ªùng g·∫∑p)
- ‚úÖ Technical Details (Database, Security, Performance)

---

## üèóÔ∏è Tech Stack

**Frontend:**
- Next.js 15 + TypeScript
- Radix UI + Tailwind CSS
- Monaco Editor

**Backend:**
- Flask + SQLAlchemy
- PostgreSQL
- JWT Authentication
- RabbitMQ

**Grading Engine:**
- Python + Docker SDK
- Docker Sandbox (isolated execution)

---

## üîß Scripts Ti·ªán √çch

```bash
# Setup t·ª± ƒë·ªông to√†n b·ªô h·ªá th·ªëng
./setup.sh

# Ch·∫°y worker ƒë·ªôc l·∫≠p
./run_worker.sh

# Setup environment cho c√°c m√¥i tr∆∞·ªùng kh√°c nhau
./setup-env.sh [local|docker|codespaces]
```

---

## üìñ ƒê·ªçc Th√™m

- **T√†i li·ªáu ƒë·∫ßy ƒë·ªß**: [`docs/DOCUMENTATION.md`](docs/DOCUMENTATION.md) ‚≠ê
- **Scripts README**: [`scripts/README.md`](scripts/README.md)

---

## ü§ù Contributing

1. Fork repository
2. T·∫°o feature branch: `git checkout -b feature/amazing-feature`
3. Commit: `git commit -m 'Add amazing feature'`
4. Push: `git push origin feature/amazing-feature`
5. T·∫°o Pull Request

---

## ÔøΩ License

MIT License

---

**üéâ Happy Coding!**


D·ª± √°n h·ªó tr·ª£ 3 m√¥i tr∆∞·ªùng v·ªõi c·∫•u h√¨nh kh√°c nhau:

| Environment | Frontend API URL | Frontend Location | Backend Location |
|-------------|------------------|-------------------|------------------|
| **Local** | `http://localhost:5000` | Local (npm) | Docker/Local |
| **Docker** | `http://backend:5000` | Container | Container |
| **Codespaces** | `http://localhost:5000` | Local (npm) | Container |

**Chuy·ªÉn ƒë·ªïi m√¥i tr∆∞·ªùng:**
```bash
./setup-env.sh [local|docker|codespaces]
```

---

### C√†i ƒë·∫∑t v√† Ch·∫°y (M·ªôt l·ªánh duy nh·∫•t)

```bash
# Clone project
git clone https://github.com/Venus2Mice/code-grader-project.git
cd code-grader-project

# T·∫°o file .env
cp .env.example .env

# Ch·∫°y setup t·ª± ƒë·ªông (s·∫Ω setup v√† ch·∫°y worker)
./setup.sh
```

**Ho·∫∑c ch·∫°y ri√™ng t·ª´ng b∆∞·ªõc:**

```bash
# 1. Kh·ªüi ƒë·ªông c√°c services (PostgreSQL, RabbitMQ, Backend, Frontend)
docker-compose up -d

# 2. Build image cho m√¥i tr∆∞·ªùng ch·∫•m C++
docker build -t cpp-grader-env ./grader-engine

# 3. Ch·∫°y worker (trong terminal ri√™ng)
./run_worker.sh
```

### Truy c·∫≠p

- **Frontend:** http://localhost:3000
- **Backend API:** http://localhost:5000
- **RabbitMQ Management:** http://localhost:15672 (guest/guest)

### T√†i kho·∫£n Test

- **Teacher:** `teacher.dev@example.com` / `password`
- **Student:** `student.dev@example.com` / `password`

---

## üìö T√ÄI LI·ªÜU CHI TI·∫æT

Xem h∆∞·ªõng d·∫´n ƒë·∫ßy ƒë·ªß t·∫°i: **[COMPLETE_GUIDE.md](./COMPLETE_GUIDE.md)**

T√†i li·ªáu bao g·ªìm:
- ‚úÖ Gi·∫£i th√≠ch v·∫•n ƒë·ªÅ ƒë√£ fix (Docker-in-Docker mount path)
- ‚úÖ H∆∞·ªõng d·∫´n setup chi ti·∫øt
- ‚úÖ C√°ch test v√† ki·ªÉm tra
- ‚úÖ Troubleshooting ƒë·∫ßy ƒë·ªß
- ‚úÖ Gi·∫£i th√≠ch k·ªπ thu·∫≠t

---

## ‚ú® T√≠nh nƒÉng N·ªïi b·∫≠t

### D√†nh cho Gi√°o vi√™n (Teacher)
-   **Qu·∫£n l√Ω L·ªõp h·ªçc:** T·∫°o, xem danh s√°ch v√† qu·∫£n l√Ω c√°c l·ªõp h·ªçc c·ªßa m√¨nh.
-   **M√£ m·ªùi An to√†n:** M·ªói l·ªõp h·ªçc c√≥ m·ªôt m√£ m·ªùi (`invite_code`) duy nh·∫•t ƒë·ªÉ g·ª≠i cho sinh vi√™n.
-   **Qu·∫£n l√Ω B√†i t·∫≠p:** D·ªÖ d√†ng t·∫°o, s·ª≠a, x√≥a c√°c b√†i t·∫≠p l·∫≠p tr√¨nh trong m·ªói l·ªõp.
-   **C·∫•u h√¨nh Test Case:** ƒê·ªãnh nghƒ©a c√°c b·ªô d·ªØ li·ªáu v√†o/ra (`input`/`output`) cho m·ªói b√†i t·∫≠p.
-   **Thi·∫øt l·∫≠p R√†ng bu·ªôc:** Gi·ªõi h·∫°n th·ªùi gian ch·∫°y (Time Limit) v√† b·ªô nh·ªõ (Memory Limit) cho m·ªói b√†i n·ªôp.
-   **Xem K·∫øt qu·∫£:** Theo d√µi ti·∫øn ƒë·ªô v√† xem k·∫øt qu·∫£ b√†i n·ªôp c·ªßa sinh vi√™n.

### D√†nh cho Sinh vi√™n (Student)
-   **Tham gia L·ªõp h·ªçc:** D·ªÖ d√†ng tham gia m·ªôt l·ªõp h·ªçc b·∫±ng m√£ m·ªùi do gi√°o vi√™n cung c·∫•p.
-   **N·ªôp b√†i:** G·ª≠i m√£ ngu·ªìn C++ ƒë·ªÉ ƒë∆∞·ª£c ch·∫•m ƒëi·ªÉm.
-   **Ph·∫£n h·ªìi T·ª©c th√¨:** Nh·∫≠n k·∫øt qu·∫£ chi ti·∫øt g·∫ßn nh∆∞ ngay l·∫≠p t·ª©c sau khi n·ªôp b√†i.
-   **K·∫øt qu·∫£ Chi ti·∫øt:** Xem tr·∫°ng th√°i c·ªßa t·ª´ng test case:
    -   `Accepted (AC)`: Ch·∫•p nh·∫≠n
    -   `Wrong Answer (WA)`: Sai k·∫øt qu·∫£
    -   `Compile Error (CE)`: L·ªói bi√™n d·ªãch
    -   `Time Limit Exceeded (TLE)`: V∆∞·ª£t qu√° th·ªùi gian
    -   `Runtime Error (RE)`: L·ªói th·ª±c thi

### H·ªá th·ªëng
-   **Ch·∫•m b√†i B·∫•t ƒë·ªìng b·ªô:** S·ª≠ d·ª•ng RabbitMQ ƒë·ªÉ x·ª≠ l√Ω c√°c b√†i n·ªôp theo h√†ng ƒë·ª£i, ƒë·∫£m b·∫£o h·ªá th·ªëng lu√¥n ph·∫£n h·ªìi nhanh ch√≥ng ngay c·∫£ khi c√≥ nhi·ªÅu l∆∞·ª£t n·ªôp.
-   **M√¥i tr∆∞·ªùng An to√†n (Sandbox):** M·ªói b√†i n·ªôp ƒë∆∞·ª£c bi√™n d·ªãch v√† th·ª±c thi trong m·ªôt container Docker ri√™ng bi·ªát, gi√∫p c√°ch ly ho√†n to√†n v√† ngƒÉn ch·∫∑n c√°c m√£ ƒë·ªôc h·∫°i.

## üèóÔ∏è Ki·∫øn tr√∫c H·ªá th·ªëng

```
+----------+      +-----------------+      +----------------+      +----------+
|          |----->| Frontend (React)|----->| Backend (Flask)|----->| RabbitMQ |
|  User    |      +-----------------+      +----------------+      +----------+
| (Browser)|                                       ^                     |
+----------+                                       | (CRUD)              | (Grading Task)
                                                     |                     v
                                             +-------+-------+      +---------------+
                                             |  PostgreSQL   |      | Worker (Python|
                                             +---------------+      |    + Docker)  |
                                                                    +---------------+
```

## üõ†Ô∏è C√¥ng ngh·ªá S·ª≠ d·ª•ng

-   **Backend:** Python, Flask, Flask-SQLAlchemy, Flask-Migrate, Flask-JWT-Extended
-   **Worker:** Python, Docker SDK
-   **Frontend:** JavaScript, React.js (Ch∆∞a tri·ªÉn khai)
-   **Database:** PostgreSQL
-   **Message Queue:** RabbitMQ
-   **Containerization:** Docker, Docker Compose

## üöÄ C√†i ƒë·∫∑t v√† Kh·ªüi ch·∫°y

D·ª± √°n ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ c√≥ th·ªÉ c√†i ƒë·∫∑t v√† ch·∫°y ch·ªâ b·∫±ng m·ªôt l·ªánh duy nh·∫•t th√¥ng qua script `setup.sh`.

### Y√™u c·∫ßu C·∫ßn thi·∫øt
-   [Docker](https://www.docker.com/get-started)
-   [Docker Compose](https://docs.docker.com/compose/install/) (Th∆∞·ªùng ƒëi k√®m v·ªõi Docker Desktop)
-   [Python 3](https://www.python.org/downloads/)
-   [Git](https://git-scm.com/downloads/)

### H∆∞·ªõng d·∫´n C√†i ƒë·∫∑t Nhanh (Khuy·∫øn kh√≠ch)

1.  **Clone Repository:**
    ```bash
    git clone <https://github.com/Venus2Mice/code-grader-project.git>
    cd <ten_thu_muc_project>
    ```

2.  **C·∫•u h√¨nh M√¥i tr∆∞·ªùng:**
    T·∫°o m·ªôt file `.env` ·ªü th∆∞ m·ª•c g·ªëc b·∫±ng c√°ch copy t·ª´ file m·∫´u:
    ```bash
    cp .env.example .env
    ```
    B·∫°n c√≥ th·ªÉ t√πy ch·ªânh c√°c gi√° tr·ªã trong file `.env` (v√≠ d·ª•: `POSTGRES_PASSWORD`), nh∆∞ng c√°c gi√° tr·ªã m·∫∑c ƒë·ªãnh ƒë√£ ƒë∆∞·ª£c thi·∫øt l·∫≠p ƒë·ªÉ ho·∫°t ƒë·ªông ngay.

3.  **Ch·∫°y Script C√†i ƒë·∫∑t:**
    Script n√†y s·∫Ω t·ª± ƒë·ªông d·ªçn d·∫πp, build, kh·ªüi ƒë·ªông c√°c service, c√†i ƒë·∫∑t CSDL v√† cu·ªëi c√πng l√† ch·∫°y worker.

    ```bash
    # C·∫•p quy·ªÅn th·ª±c thi cho script (ch·ªâ c·∫ßn l√†m m·ªôt l·∫ßn)
    chmod +x setup.sh

    # Ch·∫°y script!
    ./setup.sh
    ```

    Sau khi script ch·∫°y xong, to√†n b·ªô h·ªá th·ªëng ƒë√£ s·∫µn s√†ng!
    -   **API Backend** c√≥ th·ªÉ truy c·∫≠p t·∫°i: `http://localhost:5000`
    -   **T√†i li·ªáu API (Swagger UI)**: `http://localhost:5000/api/docs`
    -   **RabbitMQ Management**: `http://localhost:15672` (user: `guest`, pass: `guest`)
    -   Terminal hi·ªán t·∫°i c·ªßa b·∫°n s·∫Ω hi·ªÉn th·ªã log c·ªßa **Worker**.

### üß™ T√†i kho·∫£n Test
Script c√†i ƒë·∫∑t ƒë√£ t·∫°o s·∫µn c√°c t√†i kho·∫£n ƒë·ªÉ b·∫°n c√≥ th·ªÉ th·ª≠ nghi·ªám ngay:
-   **Gi√°o vi√™n:** `teacher.dev@example.com` / M·∫≠t kh·∫©u: `password`
-   **H·ªçc sinh:** `student.dev@example.com` / M·∫≠t kh·∫©u: `password`

## üë®‚Äçüíª Ch·∫°y Ri√™ng t·ª´ng Ph·∫ßn (D√†nh cho Development)

N·∫øu b·∫°n mu·ªën ch·∫°y t·ª´ng th√†nh ph·∫ßn m·ªôt c√°ch ƒë·ªôc l·∫≠p ƒë·ªÉ g·ª° l·ªói.

### 1. Ch·∫°y c√°c Service N·ªÅn t·∫£ng (Postgres, RabbitMQ, Backend)
L·ªánh n√†y s·∫Ω kh·ªüi ƒë·ªông m·ªçi th·ª© tr·ª´ worker, v√† b·∫°n c√≥ th·ªÉ ch·∫°y worker th·ªß c√¥ng.
```bash
docker compose up --build
```
Sau ƒë√≥, b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán c√°c l·ªánh `flask db...` b·∫±ng `docker compose exec backend <lenh>`. ho·∫∑c `docker exec -it container-id bash`

### 2. Ch·∫°y Worker Th·ªß c√¥ng
ƒê√¢y l√† c√°ch t·ªët nh·∫•t ƒë·ªÉ debug cho worker.
```bash
# Di chuy·ªÉn ƒë·∫øn th∆∞ m·ª•c c·ªßa worker
cd grader-engine

# K√≠ch ho·∫°t m√¥i tr∆∞·ªùng ·∫£o
source venv/bin/activate

# Ch·∫°y worker (n√≥ s·∫Ω t·ª± ƒë·ªçc file .env ·ªü th∆∞ m·ª•c g·ªëc)
python run_worker.py
```

### 3. Ch·∫°y Frontend (Khi ƒë√£ c√≥)
```bash
# Di chuy·ªÉn ƒë·∫øn th∆∞ m·ª•c frontend
cd frontend

# C√†i ƒë·∫∑t c√°c th∆∞ vi·ªán
npm install

# Kh·ªüi ƒë·ªông server development
npm start
```

## üõë D·ª´ng H·ªá th·ªëng

-   N·∫øu b·∫°n ƒë√£ ch·∫°y b·∫±ng script `setup.sh`, nh·∫•n `Ctrl+C` trong terminal ƒëang ch·∫°y worker.
-   Sau ƒë√≥, ch·∫°y l·ªánh sau ·ªü th∆∞ m·ª•c g·ªëc ƒë·ªÉ d·ª´ng v√† x√≥a c√°c container:
    ```bash
    docker compose down
    ```
-   ƒê·ªÉ x√≥a c·∫£ d·ªØ li·ªáu database, d√πng th√™m c·ªù `-v`:
    ```bash
    docker compose down -v
    ```

## üìÅ C·∫•u tr√∫c Th∆∞ m·ª•c

```
.
‚îú‚îÄ‚îÄ backend/            # Ch·ª©a m√£ ngu·ªìn Flask Backend API
‚îú‚îÄ‚îÄ grader-engine/      # Ch·ª©a m√£ ngu·ªìn Worker ch·∫•m b√†i
‚îú‚îÄ‚îÄ frontend/           # (T∆∞∆°ng lai) Ch·ª©a m√£ ngu·ªìn React Frontend
‚îú‚îÄ‚îÄ .env                # File c·∫•u h√¨nh m√¥i tr∆∞·ªùng (c·∫ßn ƒë∆∞·ª£c t·∫°o)
‚îú‚îÄ‚îÄ .env.example        # File c·∫•u h√¨nh m√¥i tr∆∞·ªùng m·∫´u
‚îú‚îÄ‚îÄ docker compose.yml  # ƒê·ªãnh nghƒ©a c√°c service Docker
‚îî‚îÄ‚îÄ setup.sh            # Script c√†i ƒë·∫∑t v√† kh·ªüi ch·∫°y t·ª± ƒë·ªông
```